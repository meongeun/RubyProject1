<h3>방명록 리스트</h3>
<a href="/post/new" style="float:right; display:inline-block;">
    <button>새 글</button>
</a>
<% if user_signed_in? %>
    <p>계정: <%=current_user.email %> </p>
    <img class="img img-thumbnail" style="width:50px; height:50px; object-fit:cover;" src="<%= current_user.profile%>">
    <%= link_to "프로필", user_profile_path %>
    <p><%= link_to "로그아웃", destroy_user_session_path, method: :delete, data: {confirm: "로그아웃 하시겠습니까?" }%> </p>
<% else %>
    <p><%= link_to "로그인", new_user_session_path %> </p>
    <%= user_roles(current_user) %>

<% end %>

<div id="map" style="width:100%; height:400px;"></div>
<ul>
    <% @posts.each do |post| %> 
        <li> 
            <h4><%=post.id%>, <%=post.title%></h4>
            
            <% if user_signed_in? %>
                <%= link_to '수정', post_modify_path(:id => post.id) if post.updatable_by? current_user %>
                <%= link_to '삭제', post_delete_path(:id => post.id) if post.deletable_by? current_user %>
                <a href="/comment/new?id=<%=post.id%>">댓글</a>
            <% end %>    
            <hr>
            <%=post.contents%>
            <hr>
            <%=post.user.name%>, <%=post.created_at.in_time_zone(9).to_formatted_s(:short) %>
            <hr>
            <ol>
                <%post.comments.each do |comment| %>
                    <li>
                        <%= comment.contents%> <a href="/comment/delete?id=<%=comment.id%>">X</a>
                    </li>
                <% end%>
            </ol>
        </li>
    <% end %>
</ul>


<script>
	var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
	var options = { //지도를 생성할 때 필요한 기본 옵션
		center: new kakao.maps.LatLng(37.5597476,126.9433341), //지도의 중심좌표.
		level: 3 //지도의 레벨(확대, 축소 정도)
	};

	var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

	var position  = new kakao.maps.LatLng(37.5597476,126.9433341); 

	// 마커를 생성합니다
	var marker = new kakao.maps.Marker({
		position: position,
		clickable: true
	});

	// 마커가 지도 위에 표시되도록 설정합니다
	marker.setMap(map);

	// 아래 코드는 지도 위의 마커를 제거하는 코드입니다
	// marker.setMap(null);    

	var iwContent = '<div style="padding:5px;">이화여자대학교</div>',
		iwRemoveable = true;
	var infoWindow = new kakao.maps.InfoWindow({
	content: iwContent,
	removable: iwRemoveable
	});

	kakao.maps.event.addListener(marker, 'click', function() {
      // 마커 위에 인포윈도우를 표시합니다
      infoWindow.open(map, marker);  
	});




</script>
